run_id: reduce_diamond_benchmarks_learnckpp

report_dir: reports
trace_h5: artifacts/traces/diamond_benchmarks_diamond_trace.h5

reduction:
  mode: learnckpp

qoi:
  species_last: [H2, CH4, c6HH, C(d)]
  species_max: [H, CH3, c6HM]

evaluation:
  rel_tolerance: 0.40
  rel_eps: 1.0e-12
  surrogate_split:
    mode: in_sample
  physical_gate:
    enabled: true
    max_conservation_violation: 5.0e-3
    max_negative_steps: 0

surrogate:
  model: linear_ridge
  l2: 1.0e-6
  perturb_gain: 1.0
  blend_reference: 0.0

gate:
  min_pass_rate: 0.75
  max_mean_rel_diff: 0.40
  max_conservation_violation: 0.005

selection:
  policy: physics_first_pareto
  weights:
    err: 0.55
    reaction_comp: 0.30
    species_comp: 0.10
    floor_margin: 0.05
    balance_margin: 0.05
    coverage_margin: 0.05
    cluster_size_margin: 0.03

balance_constraints:
  enabled: true
  balance_mode: hybrid
  min_reaction_species_ratio: 0.40
  max_reaction_species_ratio: 4.00
  min_active_species_coverage: 0.50
  min_weighted_active_species_coverage: 0.80
  min_active_species_coverage_top_weighted: 0.80
  min_essential_species_coverage: 0.85
  min_nu_rank_ratio: 0.35
  essential_species: [H2, CH4, c6HH, C(d), H, CH3, c6HM]
  activity_weights:
    x: 0.25
    wdot: 0.55
    flux: 0.20

physics_constraints:
  phase_mixing_forbidden: true
  surface_site_family_strict: true
  nonnegative_required: true

physics_floors:
  min_reactions_abs: 2
  min_reactions_ratio: 0.10
  min_species_abs: 3
  min_species_ratio: 0.20

merge:
  hard:
    element_overlap_required: true
  overlap_method: jaccard
  soft:
    penalty:
      phase: 0.80
      charge: 0.80
      radical: 0.40
      role: 0.30
  weights:
    elem: 1.0
    frag: 0.8
    flux: 1.2
    role: 0.5

search:
  seed: 7
  merge_search:
    min_pair_score: -0.50
  stages:
    - name: A
      target_ratio: 0.75
      penalty_scale: 1.00
      prune_lambda: 0.001
      prune_keep_ratio: 0.90
      prune_threshold: 0.45
      prune_exact_keep: true
      metric_drift: 1.02
    - name: B
      target_ratio: 0.55
      penalty_scale: 0.70
      prune_lambda: 0.004
      prune_keep_ratio: 0.70
      prune_threshold: 0.40
      prune_exact_keep: true
      metric_drift: 1.08
    - name: C
      target_ratio: 0.35
      penalty_scale: 0.40
      prune_lambda: 0.010
      prune_keep_ratio: 0.50
      prune_threshold: 0.35
      prune_exact_keep: true
      metric_drift: 1.15

learnckpp:
  fallback_to_baseline_on_error: true
  adaptive_keep_ratio:
    enabled: true
    min_keep_ratio: 0.10
    max_keep_ratio: 0.95
    source_multiplier:
      synthetic: 0.95
      trace_h5: 1.10
      network_dir: 1.10
      default: 1.00
    split_multiplier:
      in_sample: 1.00
      kfold: 1.10
      default: 1.00
    stage_multiplier: [1.20, 1.05, 0.90]
    feedback_trigger_ratio: 0.80
    feedback_multiplier: 1.15
    physical_feedback:
      enabled: true
      fail_multiplier: 1.25
      cons_multiplier: 1.10
      negative_multiplier: 1.10
      raw_conservation_threshold: 1.0
      raw_negative_steps_threshold: 8
    auto_tune:
      enabled: true
      multipliers: [0.90, 1.00, 1.10, 1.25]
      compression_weight: 1.0
      safety_weight: 2.0
      min_keep_floor: 0.10
      risk_keep_boost: 0.35
      risk_cap: 3.0
      source_risk:
        synthetic: 0.15
        trace_h5: 0.40
        network_dir: 0.40
        default: 0.20
      split_risk:
        in_sample: 0.0
        kfold: 0.15
        default: 0.0
      physical_risk:
        cons_norm: 1.0
        neg_norm: 20.0
        cons_weight: 1.0
        neg_weight: 0.8
        fail_penalty: 1.0
  candidate:
    max_candidates: 256
    min_flux_quantile: 0.70
    min_flux_quantile_by_stage:
      A: 0.65
      B: 0.55
      C: 0.50
    min_candidates_floor: 2
    min_candidates_floor_by_stage:
      A: 6
      B: 5
      C: 4
    backfill_by_uncovered_clusters: true
    min_active_clusters: 3
  select:
    method: hard_concrete
    lambda_l0: 1.0e-3
    target_keep_ratio: 0.30
    min_keep_count: 2
    min_active_clusters: 3
    coverage_aware_swap_steps: 12
  coverage_postselect:
    enabled: true
    target_weighted_coverage: 0.80
    target_essential_coverage: 0.85
  rate:
    model: log_linear
    l2: 1.0e-6
  projection:
    enabled: true
    max_iter: 4
  fallback:
    select_method: l1_threshold
    threshold_quantile: 0.75
